<div class="multi-select">
  <!-- Label -->
  <label class="label">
    <span class="font-semibold">
      {{ label() }}@if (required()) {<span class="text-error">*</span>}
    </span>
  </label>

  <!-- Search box (conditionally shown) -->
  @if (showSearch()) {
    <div class="mb-2">
      <input
        type="search"
        class="input input-sm input-bordered w-full"
        placeholder="Search..."
        [value]="searchTerm()"
        (input)="updateSearchTerm($any($event.target).value)" />
    </div>
  }

  <!-- Select all/none shortcuts -->
  @if (filteredOptions().length > 0) {
    <div class="flex gap-2 mb-2">
      <button
        type="button"
        class="btn btn-xs btn-ghost"
        (click)="selectAll()">
        Select All
      </button>
      <button
        type="button"
        class="btn btn-xs btn-ghost"
        (click)="selectNone()">
        Select None
      </button>
    </div>
  }

  <!-- Options list -->
  <div class="max-h-64 overflow-y-auto border border-base-300 rounded-lg p-2">
    @if (filteredOptions().length > 0) {
      @for (option of filteredOptions(); track option.id) {
        <label class="label cursor-pointer justify-start gap-1 p-1">
          <input
            type="checkbox"
            class="checkbox checkbox-sm checkbox-primary"
            [checked]="isSelected(option.id)"
            (change)="toggle(option.id)" />
          <span class="label-text">{{ option.display_name }}</span>
          @if (option['color']) {
            <span
              class="w-3 h-3 rounded-full inline-block"
              [style.background-color]="option['color']">
            </span>
          }
        </label>
      }
    } @else {
      <div class="text-sm text-base-content/60 p-2">
        @if (searchTerm()) {
          No items match "{{ searchTerm() }}"
        } @else {
          No items available
        }
      </div>
    }
  </div>

  <!-- Selected count -->
  <div class="text-xs text-base-content/60 mt-1">
    {{ selectedCount() }} selected
  </div>
</div>
