<div class="mb-4 w-full max-w-xs" [formGroup]="form()">
  <label class="label" [for]="prop().column_name">
    <span class="font-medium">{{ prop().display_name }}{{ prop().is_nullable ? '' : '*'}}</span>
  </label>

  @if (propType() == EntityPropertyType.Date) {
    <input type="date" placeholder="Type here" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.DateTime) {
    <input type="datetime" placeholder="Type here" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.DateTimeLocal) {
    <input type="datetime-local" placeholder="Type here" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.TextShort) {
    <input type="text" placeholder="Type here" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.TextLong) {
    <textarea class="textarea h-24" placeholder="Type here" [id]="prop().column_name" [formControlName]="prop().column_name"></textarea>
  }
  @if (propType() == EntityPropertyType.Money) {
    <input type="text" currencyMask placeholder="Type here" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.IntegerNumber) {
    <input type="number" placeholder="Type here" step=1 mask="0*" [allowNegativeNumbers]="true" class="input w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.Boolean) {
    <input type="checkbox" class="toggle" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.ForeignKeyName) {
    @if (selectOptions$ | async; as selectOptions) {
      <select class="select w-full max-w-xs" [id]="prop().column_name" [formControlName]="prop().column_name">
        @if (prop().is_nullable) {
          <option [value]="null">Select an Option</option>
        }
        @for (option of selectOptions; track option) {
          <option [value]="option.id">{{option.text}}</option>
        }
      </select>
    }
  }

  @if (propType() == EntityPropertyType.GeoPoint) {
    <app-geo-point-map
      mode="edit"
      [initialValue]="form().get(prop().column_name)?.value"
      width="100%"
      height="300px"
      maxWidth="400px"
      (valueChange)="onMapValueChange($event)">
    </app-geo-point-map>
  }

  @if (propType() == EntityPropertyType.Unknown) {
  }

  @if (form().controls[prop().column_name]; as ctl) {
    @if (ctl.invalid && (ctl.dirty || ctl.touched)) {
      <div
        class="text-error mt-1">
        @if (ctl.errors?.['required']) {
          <div>
            {{ prop().display_name }} is required.
          </div>
        }
      </div>
    }
  }
</div>