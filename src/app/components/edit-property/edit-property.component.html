<div class="mb-4 w-full" [formGroup]="form()">
  <label class="label" [for]="prop().column_name">
    <span class="font-semibold">
      {{ prop().display_name }}{{ prop().is_nullable ? '' : '*'}}
      @if (prop().description) {
        <div class="tooltip tooltip-right inline-block" [attr.data-tip]="prop().description">
          <span class="material-symbols-outlined text-info cursor-help ml-1 text-base align-middle">help_outline</span>
        </div>
      }
    </span>
  </label>

  @if (propType() == EntityPropertyType.Date) {
    <input type="date" placeholder="Type here" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.DateTime) {
    <input type="datetime-local" placeholder="Type here" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.DateTimeLocal) {
    <input type="datetime-local" placeholder="Type here" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.TextShort) {
    <input type="text" placeholder="Type here" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.TextLong) {
    <textarea class="textarea h-24 w-full" placeholder="Type here" [id]="prop().column_name" [formControlName]="prop().column_name"></textarea>
  }
  @if (propType() == EntityPropertyType.Money) {
    <input type="text" currencyMask placeholder="Type here" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.IntegerNumber) {
    <input type="number" placeholder="Type here" step=1 mask="0*" [allowNegativeNumbers]="true" class="input w-full" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.Boolean) {
    <input type="checkbox" class="toggle" [id]="prop().column_name" [formControlName]="prop().column_name" />
  }
  @if (propType() == EntityPropertyType.ForeignKeyName) {
    @if (selectOptions$ | async; as selectOptions) {
      <select class="select w-full" [id]="prop().column_name" [formControlName]="prop().column_name">
        @if (prop().is_nullable) {
          <option [value]="null">Select an Option</option>
        }
        @for (option of selectOptions; track option) {
          <option [value]="option.id">{{option.text}}</option>
        }
      </select>
    }
  }

  @if (propType() == EntityPropertyType.User) {
    @if (selectOptions$ | async; as selectOptions) {
      <select class="select w-full" [id]="prop().column_name" [formControlName]="prop().column_name">
        @if (prop().is_nullable) {
          <option [value]="null">Select a User</option>
        }
        @for (option of selectOptions; track option) {
          <option [value]="option.id">{{option.text}}</option>
        }
      </select>
    }
  }

  @if (propType() == EntityPropertyType.GeoPoint) {
    <app-geo-point-map
      mode="edit"
      [initialValue]="form().get(prop().column_name)?.value"
      width="100%"
      height="250px"
      (valueChange)="onMapValueChange($event)">
    </app-geo-point-map>
  }

  @if (propType() == EntityPropertyType.Color) {
    <div class="flex items-center gap-4">
      <input type="color" class="w-24 h-12 cursor-pointer" [id]="prop().column_name" [formControlName]="prop().column_name" />
      <input type="text" placeholder="#3B82F6" class="input w-full font-mono" [formControlName]="prop().column_name" />
    </div>
  }

  @if (propType() == EntityPropertyType.Unknown) {
  }

  @if (form().controls[prop().column_name]; as ctl) {
    @if (ctl.invalid && (ctl.dirty || ctl.touched)) {
      <div class="text-error text-sm mt-1">
        @if (ctl.errors?.['required']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'required') {
                  {{ rule.message }}
                }
              }
            } @else {
              {{ prop().display_name }} is required.
            }
          </div>
        }
        @if (ctl.errors?.['min']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'min') {
                  {{ rule.message }}
                }
              }
            } @else {
              Value must be at least {{ ctl.errors?.['min'].min }}.
            }
          </div>
        }
        @if (ctl.errors?.['max']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'max') {
                  {{ rule.message }}
                }
              }
            } @else {
              Value must be no more than {{ ctl.errors?.['max'].max }}.
            }
          </div>
        }
        @if (ctl.errors?.['minlength']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'minLength') {
                  {{ rule.message }}
                }
              }
            } @else {
              Must be at least {{ ctl.errors?.['minlength'].requiredLength }} characters.
            }
          </div>
        }
        @if (ctl.errors?.['maxlength']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'maxLength') {
                  {{ rule.message }}
                }
              }
            } @else {
              Must be no more than {{ ctl.errors?.['maxlength'].requiredLength }} characters.
            }
          </div>
        }
        @if (ctl.errors?.['pattern']) {
          <div>
            @if (prop().validation_rules) {
              @for (rule of prop().validation_rules; track rule.type) {
                @if (rule.type === 'pattern') {
                  {{ rule.message }}
                }
              }
            } @else {
              Invalid format.
            }
          </div>
        }
      </div>
    }
  }
</div>