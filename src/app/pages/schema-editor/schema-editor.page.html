<div class="schema-editor no-prose">
  <!-- Toolbar (spans full width) -->
  <div class="toolbar">
    <h1 class="text-2xl font-bold">Schema Editor</h1>
    @if (!loading() && !error() && editMode()) {
      <button class="btn btn-primary ml-4" (click)="autoArrange()">
        <span class="material-symbols-outlined">auto_awesome</span>
        Auto-Arrange
      </button>
    }
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <span class="loading loading-spinner loading-lg text-primary"></span>
      <p class="mt-4 text-lg">Loading schema data...</p>
    </div>
  }

  <!-- Error State -->
  @if (error(); as errorMsg) {
    <div class="error-container">
      <div class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>{{ errorMsg }}</span>
      </div>
    </div>
  }

  <!-- Main Content Grid (Canvas + Inspector) -->
  @if (!loading() && !error()) {
    <div class="content-grid" [class.inspector-open]="selectedEntity() !== null">
      <!-- Canvas Column -->
      <div class="canvas-column">
        <div #canvasContainer class="canvas-container"></div>

        <!-- Zoom Controls -->
        <div class="zoom-controls">
          <div class="btn-group btn-group-vertical">
            <button class="btn btn-sm" (click)="zoomIn()" title="Zoom In">
              <span class="material-symbols-outlined">add</span>
            </button>
            <button class="btn btn-sm" (click)="zoomOut()" title="Zoom Out">
              <span class="material-symbols-outlined">remove</span>
            </button>
            <button class="btn btn-sm" (click)="zoomToFit()" title="Zoom to Fit">
              <span class="material-symbols-outlined">fit_screen</span>
            </button>
          </div>
        </div>

        <!-- Instructions Panel (Expanded or Minimized) -->
        @if (showInstructions()) {
          <!-- Expanded: Full Instructions Panel -->
          <div class="instructions">
            <div class="alert alert-info">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <h3 class="font-bold">Instructions</h3>
                <ul class="list-disc list-inside text-sm">
                  <li>Click an entity box to see details in the inspector panel</li>
                  <li><strong>Click and drag</strong> anywhere to pan the diagram</li>
                  <li>Use zoom controls or mouse wheel to zoom in/out</li>
                  <li>Lines show relationships between domain entities</li>
                  <li>System types (Files, Users) appear as property types, not relationships</li>
                </ul>
              </div>
              <button class="btn btn-sm btn-circle btn-ghost" (click)="toggleInstructions()" title="Minimize">
                <span class="material-symbols-outlined">remove</span>
              </button>
            </div>
          </div>
        } @else {
          <!-- Minimized: Info Icon Button -->
          <div class="instructions-minimized">
            <button class="btn btn-circle btn-info btn-sm" (click)="toggleInstructions()" title="Show Instructions">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </button>
          </div>
        }
      </div>

      <!-- Inspector Panel Column -->
      <div class="inspector-column">
        <app-schema-inspector-panel
          [entity]="selectedEntity()"
          [systemTypes]="systemTypes()"
          [junctionTables]="junctionTables()"
          (close)="onInspectorClose()"
          (navigateToEntity)="onNavigateToEntity($event)"
        />
      </div>
    </div>
  }
</div>
