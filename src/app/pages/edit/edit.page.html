<div class="prose">
  <ng-container *ngrxLet="entity$ as entity">@if (entity) {
    <ng-container *ngrxLet="properties$ as props">@if (props) {
      <ng-container *ngrxLet="data$ as data">@if (data) {
        <h1>{{ entity.display_name }}: {{ data.display_name }} <sub>(Id: {{entityId}})</sub></h1>
        @if (editForm) {
          <form [formGroup]="editForm" (ngSubmit)="submitForm($event)">
            @for (prop of props; track prop) {
              <div>
                <h3>{{ prop.display_name }} {{ prop.type }}</h3>
                <app-edit-property [property]="prop" [formGroup]="editForm"></app-edit-property>
              </div>
            }
            <div class="divider"></div>
            <button class="btn btn-accent" [disabled]="editForm.invalid">
              <span class="material-symbols-outlined">save</span> Save
            </button>
          </form>
        }
      }</ng-container>
    }</ng-container>
    <app-dialog #successDialog>
      <button class="btn mx-2" (click)="navToList(entity.table_name)">Back to {{entity.display_name}} list</button>
      <button class="btn mx-2" (click)="navToRecord(entity.table_name, entityId)">Back to record</button>
    </app-dialog>
    <app-dialog #errorDialog>
      <button class="btn mx-2">Try again</button>
      <button class="btn mx-2" (click)="navToList(entity.table_name)">Back to {{entity.display_name}} list</button>
    </app-dialog>
  }</ng-container>
</div>