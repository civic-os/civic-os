-- Revert civic_os:v0-18-0-entity-actions from pg

BEGIN;

-- ============================================================================
-- 7. DROP PUBLIC VIEW
-- ============================================================================

DROP VIEW IF EXISTS public.schema_entity_actions;


-- ============================================================================
-- 6. (Grants revoked automatically with table drop)
-- ============================================================================


-- ============================================================================
-- 5. (RLS policies dropped automatically with table drop)
-- ============================================================================


-- ============================================================================
-- 4. (Indexes dropped automatically with table drop)
-- ============================================================================


-- ============================================================================
-- 3. DROP ENTITY ACTIONS TABLE
-- ============================================================================

DROP TABLE IF EXISTS metadata.entity_actions CASCADE;


-- ============================================================================
-- 2. DROP RPC PERMISSION CHECK FUNCTION
-- ============================================================================

DROP FUNCTION IF EXISTS public.has_rpc_permission(NAME);


-- ============================================================================
-- 1. DROP RPC PERMISSIONS TABLES
-- ============================================================================

DROP TABLE IF EXISTS metadata.protected_rpc_roles CASCADE;
DROP TABLE IF EXISTS metadata.protected_rpcs CASCADE;


-- ============================================================================
-- NOTIFY POSTGREST TO RELOAD SCHEMA CACHE
-- ============================================================================

NOTIFY pgrst, 'reload schema';


COMMIT;
