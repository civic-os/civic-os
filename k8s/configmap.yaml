# Copyright (C) 2023-2025 Civic OS, L3C
# AGPL-3.0-or-later

apiVersion: v1
kind: ConfigMap
metadata:
  name: civic-os-config
  namespace: civic-os
data:
  # Frontend configuration (SPA makes API calls from browser to public endpoint)
  # IMPORTANT: Must be the public HTTPS URL, not internal service URL
  POSTGREST_URL: "https://api.yourdomain.com/"

  # Swagger UI configuration (point to public API for OpenAPI spec)
  # PostgREST automatically exposes OpenAPI spec at its root endpoint
  SWAGGER_API_URL: "https://api.yourdomain.com/"

  # Keycloak configuration
  KEYCLOAK_URL: "https://auth.civic-os.org"
  KEYCLOAK_REALM: "civic-os-dev"
  KEYCLOAK_CLIENT_ID: "myclient"

  # Map configuration (customize for your location)
  MAP_TILE_URL: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
  MAP_ATTRIBUTION: "&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"
  MAP_DEFAULT_LAT: "43.0125"
  MAP_DEFAULT_LNG: "-83.6875"
  MAP_DEFAULT_ZOOM: "13"

  # PostgREST configuration
  PGRST_DB_SCHEMA: "public,metadata"
  PGRST_DB_ANON_ROLE: "web_anon"
  PGRST_DB_PRE_REQUEST: "public.check_jwt"
  PGRST_JWT_AUD: "account"
  PGRST_LOG_LEVEL: "info"

  # S3 / File Storage Configuration (v0.10.0+)
  # Public-facing S3 endpoint (used by frontend for file downloads)
  S3_PUBLIC_ENDPOINT: "https://s3.yourdomain.com"
  S3_BUCKET: "civic-os-files-prod"
  S3_REGION: "us-east-1"
  # S3_ENDPOINT: ""  # Leave empty for AWS S3, set for MinIO/S3-compatible storage

  # Thumbnail Worker Configuration (v0.10.0+)
  # Max concurrent thumbnail generation workers (default: 5)
  # Higher values = faster processing but more memory usage (~100MB per worker)
  # Scale based on your workload and available resources
  THUMBNAIL_MAX_WORKERS: "5"

  # Notification Configuration (v0.11.0+)
  # Public URL for links in notification emails
  SITE_URL: "https://app.yourdomain.com"
  # Email address for notification sender (must be verified with your SMTP provider)
  SMTP_FROM: "notifications@yourdomain.com"
  # Timezone for notification timestamps (default: UTC)
  # NOTIFICATION_TIMEZONE: "America/New_York"

  # Payment Configuration (v0.13.0+, optional)
  # Stripe publishable key (required for payment checkout UI)
  # This is a PUBLIC key (pk_...) - safe to include in configmap
  STRIPE_PUBLISHABLE_KEY: "pk_test_your_key_here"
  # Currency code for Stripe payments (default: USD)
  # PAYMENT_CURRENCY: "USD"

  # Processing Fee Configuration (v0.21.0+, optional)
  # Enable to transparently pass credit card processing fees to customers
  # Formula: total = base + (base * percent/100) + flat_cents/100
  # Example: $100 base + 2.9% + $0.30 = $103.20 total
  #
  # PROCESSING_FEE_ENABLED: "true"       # Enable fee pass-through (default: false)
  # PROCESSING_FEE_PERCENT: "2.9"        # Percentage fee (e.g., 2.9 for 2.9%)
  # PROCESSING_FEE_FLAT_CENTS: "30"      # Flat fee in cents (e.g., 30 for $0.30)
  # PROCESSING_FEE_REFUNDABLE: "false"   # Whether fee is refundable (default: false)
  #                                      # false = max refund is base amount only
  #                                      # true = max refund includes processing fee
