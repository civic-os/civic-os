# Copyright (C) 2023-2025 Civic OS, L3C
# AGPL-3.0-or-later

# IMPORTANT: This is a TEMPLATE ONLY - DO NOT commit actual secrets to git!
#
# This file shows the structure but should NOT be applied directly.
# Instead, create secrets using one of these methods:

# Method 1: kubectl create (for development/testing)
# ------------------------------------------------------
# For managed external database (recommended):
#
#   kubectl create secret generic civic-os-secrets \
#     --from-literal=DATABASE_URL='postgresql://user:pass@host:port/dbname?sslmode=require' \
#     --namespace civic-os
#
# Example for Digital Ocean managed PostgreSQL:
#   DATABASE_URL='postgresql://doadmin:password@db-postgresql-nyc3-12345.ondigitalocean.com:25060/defaultdb?sslmode=require'

# Method 2: Sealed Secrets (RECOMMENDED for production)
# -------------------------------------------------------
# Sealed Secrets encrypts secrets so they can be safely committed to git
#
# 1. Install Sealed Secrets controller:
#    kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml
#
# 2. Install kubeseal CLI:
#    brew install kubeseal  # or download from GitHub releases
#
# 3. Create a regular secret file (secrets-temp.yaml):
#    apiVersion: v1
#    kind: Secret
#    metadata:
#      name: civic-os-secrets
#      namespace: civic-os
#    type: Opaque
#    stringData:
#      DATABASE_URL: "postgresql://user:pass@host:port/dbname?sslmode=require"
#
# 4. Encrypt it with namespace-wide scope:
#    kubeseal --controller-namespace=kube-system \
#             --scope namespace-wide \
#             --format=yaml < secrets-temp.yaml > sealed-secrets.yaml
#
# 5. Delete the temp file and commit sealed-secrets.yaml:
#    rm secrets-temp.yaml
#    git add sealed-secrets.yaml
#
# IMPORTANT: Use --scope namespace-wide if using Kustomize namePrefix
# Otherwise the sealed secret won't decrypt after name transformation

# Method 3: External secret management (for production)
# -------------------------------------------------------
# - External Secrets Operator (https://external-secrets.io/)
# - HashiCorp Vault
# - AWS Secrets Manager / GCP Secret Manager / Azure Key Vault

---
# TEMPLATE STRUCTURE (for reference only):
apiVersion: v1
kind: Secret
metadata:
  name: civic-os-secrets
  namespace: civic-os
type: Opaque
stringData:
  # For managed external database (production - RECOMMENDED)
  # PostgREST will use this if DATABASE_URL is present
  DATABASE_URL: "postgresql://user:password@host:port/dbname?sslmode=require"

  # For in-cluster PostgreSQL (development only)
  # Only used if DATABASE_URL is not set
  # POSTGRES_PASSWORD: "generate-with-openssl-rand-base64-32"
